#!/bin/bash

focused="%{U#f5ffa500+u}----------%{U-}"
active="%{U#f5cccccc+u}----------%{U-}"
normal="%{U#a0aaaaaa+u}----------%{U-}"

#focused="%{U#f5ffa500+u}---------%{U-}"
#active="%{U#f5cccccc+u}---------%{U-}"
#normal="%{U#a0aaaaaa+u}---------%{U-}"

desktops() {
    desktops=""
    for e in $(echo $1 | cut -d':' -f2-5 | tr ':' '\n')
    do
        if [ "${e:0:1}" == "O" ]; then
            desktops="$desktops $focused"
        elif [ "${e:0:1}" == "F" ]; then
            desktops="$desktops $focused"
        elif [ "${e:0:1}" == "o" ]; then
            desktops="$desktops $active"
        else
            desktops="$desktops $normal"
        fi
    done
    echo $desktops
}

bspc control --subscribe | \
while read -r line ; do

    # skip messages for other monitors
    [ $( echo $line | grep "^WM$MONITOR" ) ] || continue

    output=$(desktops $line)
    echo "%{c}$output%{r}"
done | bar-aint-recursive -bp -g "263x5+829" -u 3 -F "#00FFFFFF" -B "#00000000" 
